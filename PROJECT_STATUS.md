# PolyAccess Project Status

Last updated: 2026-01-29

## What This Is

PolyAccess is a general-purpose low-code platform for building database-backed applications with forms and reports. It runs on PostgreSQL (self-hosted) with a web UI (ClojureScript/Reagent) and optional Electron desktop wrapper.

**Entry point**: Migration tool for MS Access databases
**Actual product**: Modern low-code platform with LLM assistance, no vendor lock-in

## Business Model

PostgreSQL-style open core:
- **Free**: Platform, self-hosting, full source
- **Paid**: Managed hosting, migration services, custom development

Target users escaping legacy platforms (Access, FileMaker, FoxPro, Lotus Notes) who want:
- Modern web/desktop deployment
- LLM-assisted development
- No per-seat licensing
- Data ownership (self-hosted PostgreSQL)

## Technical Architecture

```
ui/                    ClojureScript/Reagent frontend
  src/app/
    state.cljs         State management, API calls, CRUD operations
    views/
      form_editor.cljs Form designer and data entry
      table_viewer.cljs Table datasheet and design views
      query_viewer.cljs Query results and SQL editor
      module_viewer.cljs Read-only function display
      main.cljs        Main layout, sidebar, chat panel

server/                Node.js/Express backend
  index.js             Main server, schema routing middleware
  routes/
    data.js            CRUD for table records
    databases.js       Multi-database management
    forms.js           Form definition storage
    metadata.js        Table/query/function introspection
    graph.js           Dependency/intent graph API
  graph/
    schema.js          Graph table creation
    query.js           Node/edge CRUD, traversal
    populate.js        Schema/form scanning
    render.js          Prose output for LLM

electron/              Desktop wrapper

forms/                 EDN form definitions
skills/                LLM guidance documents
settings/              App configuration
```

## Multi-Database Architecture

- Single PostgreSQL instance
- Schema-per-database isolation (e.g., `calculator`, `inventory` schemas)
- `shared` schema for cross-database data
- X-Database-ID header routes requests to correct schema
- Switch databases without reconnecting

## Current Implementation Status

### Working:
- [x] Form editor with Access-style Property Sheet (Format/Data/Event/Other/All tabs)
- [x] Design View: drag-drop fields, position controls, grid snap
- [x] Form View: live data entry against database
- [x] Record navigation: First/Prev/Next/Last/New buttons
- [x] CRUD operations: display, edit existing, create new records
- [x] Auto-save on navigation between records
- [x] Multi-database schema routing
- [x] Chat panel with LLM integration
- [x] Dependency/intent graph (tables, columns, forms, controls, intents)
- [x] LLM tools for querying dependencies and proposing intents
- [x] Table viewer with datasheet (editable) and design views
- [x] Query viewer with results and SQL views
- [x] Module viewer (read-only function display)
- [x] Context-aware chat prompts based on active object
- [x] UI state persistence (remembers open tabs across sessions)

### Not Yet Implemented:
- [ ] Report designer (banded reports like Access)
- [ ] Subforms (master-detail)
- [ ] Combo box row sources
- [ ] Continuous forms view
- [ ] Form/report printing (PDF generation)
- [ ] User authentication
- [ ] Database creation wizard in UI

## Key Technical Details

### Form Control Binding
Controls bind to database fields via:
- `:field` - set by drag-drop from field list
- `:control-source` - set via Property Sheet (Access terminology)

Both work identically. Field names must match database column names exactly.

### Record Saving (state.cljs)
- `save-current-record!` handles INSERT (new) and UPDATE (existing)
- Detects new records by checking if primary key is nil
- Converts keyword keys to strings for API
- Auto-saves when navigating, switching forms, or changing modes

### Database Requirements
Tables need auto-increment primary keys:

ALTER TABLE tablename ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY

## Implementation Plan

See `/home/ken/.claude/plans/fizzy-squishing-pudding.md` for the full multi-database transition plan.

Completed:
- Phase 1: PostgreSQL Schema Setup
- Phase 2: Server Schema-Based Routing (mostly complete)

Remaining:
- Phase 3: Database Configuration Storage
- Phase 4: Forms Directory Restructure (per-database)
- Phase 5: UI Database Selector dropdown
- Phase 6: Electron Setup Flow Update

## Enterprise Opportunity: Shadow IT Discovery

Large organizations have hundreds or thousands of "unofficial" Access/Excel/FileMaker databases built by employees. These shadow databases are invisible to IT but reveal what's actually happening in the organization.

### What Shadow Databases Reveal

- **Process gaps**: Why did someone build this? What official system failed them?
- **Actual workflows**: What people really do vs. prescribed processes
- **Data silos**: Information that exists nowhere else
- **Tribal knowledge**: Business logic that walks out when someone retires
- **Compliance risks**: Untracked data, no backups, no audit trails

### Discovery & Analysis Service

1. **Scan**: Find all .accdb/.mdb/.fmp12 files across network shares
2. **Parse**: Extract table structures, relationships, queries, forms, code
3. **Analyze**: LLM summarizes what each database does and why it exists
4. **Map**: Identify overlaps, dependencies, data flows between shadow systems
5. **Report**: "Here's what's actually running your organization"

### Enterprise Value Proposition

> "You have hundreds of shadow databases built by employees. We'll tell you what they do, what risks they pose, which ones are critical, and migrate the important ones to a governed platform - without losing the business logic your people built."

### Revenue Potential

- **Discovery engagement**: Fixed fee to scan and analyze
- **Risk assessment**: Identify compliance/security issues
- **Migration projects**: Move critical databases to PolyAccess
- **Ongoing hosting**: Managed platform for consolidated apps
- **Consulting**: Process documentation, system integration

The migration tool becomes an organizational x-ray. Shadow IT analysis is consulting gold.

---

## Future Features

### Reports (High Priority)
Access-style banded reports with:
- Report/Page/Group headers and footers
- Detail section
- Grouping, sorting, aggregates
- PDF generation for printing

Challenges: pagination, page headers/footers, "keep together" logic

### Additional Migration Targets
- FileMaker Pro (large market, expensive licensing)
- Visual FoxPro (discontinued, legacy apps need migration)
- Lotus Notes (IBM pushing users off)

All share: forms + database + scripting. Same conversion pattern applies.

## Files to Know

| File | Purpose |
|------|---------|
| `ui/src/app/state.cljs` | All state management, API calls, save/load logic |
| `ui/src/app/views/form_editor.cljs` | Form designer and view components |
| `ui/src/app/views/table_viewer.cljs` | Table datasheet editing and design view |
| `ui/src/app/views/query_viewer.cljs` | Query results and SQL editor |
| `ui/src/app/views/module_viewer.cljs` | Read-only PostgreSQL function display |
| `ui/src/app/views/main.cljs` | Main layout, chat panel with context-aware prompts |
| `server/index.js` | Express server, schema routing middleware |
| `server/routes/data.js` | CRUD endpoints for records |
| `server/routes/sessions.js` | UI state persistence endpoints |
| `server/graph/` | Dependency/intent graph (schema, query, populate, render) |
| `skills/form-design.md` | LLM guidance for form creation |
| `CLAUDE.md` | Project instructions for Claude |

## Recent Session Summary (2026-01-29)

### Morning Session
1. Implemented unified dependency/intent graph
   - `shared._nodes` for tables, columns, forms, controls, intents
   - `shared._edges` for relationships (contains, references, bound_to, serves)
   - Populates once on first startup, incremental updates on form save
   - REST API at `/api/graph/*`
2. Added LLM tools for graph: `query_dependencies`, `query_intent`, `propose_intent`

### Evening Session
3. Built Table Viewer
   - Datasheet view with inline cell editing
   - Design view showing table structure
   - Right-click context menu (New Record, Delete, Cut, Copy, Paste)
   - Cell navigation with Tab/Shift+Tab

4. Built Query Viewer
   - Results view runs query and displays data
   - SQL view for editing with Run button
   - Safety: only SELECT queries allowed

5. Built Module Viewer
   - Read-only display of PostgreSQL function source
   - Shows signature (arguments, return type, description)
   - Editing via AI chat only

6. Added context-aware chat prompts
   - Forms: "I can help with records, data, or form design..."
   - Tables: "I can help with queries, columns, or structure..."
   - Queries: "I can help modify SQL or explain what it does..."
   - Modules: "I can help edit or create functions..."

7. Added UI state persistence
   - Saves open tabs, active tab, and database to `app_config`
   - Restores on page refresh or app reopen
   - Auto-saves when opening/closing tabs or switching databases

## Next Session Priorities

1. Test all viewers with real database data
2. Add syntax highlighting to SQL and module code views
3. Consider subform support for master-detail relationships
4. Report designer (banded reports)
